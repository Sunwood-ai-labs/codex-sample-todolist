#!/usr/bin/env bash
set -euo pipefail

# This script generates blog posts from git commit history
BLOG_DIR="docs-site/blog"

# Create blog directory
rm -rf "$BLOG_DIR"
mkdir -p "$BLOG_DIR"

# Write authors file
cat > "$BLOG_DIR/authors.yml" << 'EOPY'
# Author information for autogenerated posts
sunwood:
  name: Sunwood-ai-labs
  url: https://github.com/Sunwood-ai-labs
EOPY

# Iterate through commits in reverse chronological order
git rev-list --reverse HEAD | while read -r rev; do
  # Extract metadata
  date=$(git show -s --format=%cI "$rev")
  title=$(git show -s --format=%s "$rev")
  slug=${rev:0:7}
  # Prepare filename
  filename="$BLOG_DIR/${date:0:10}-$slug.md"
  # Write progress report post
  cat > "$filename" << EOF
---
title: "ðŸš€ é€²æ—: $title"
date: $date
slug: /blog/$slug/
authors: [sunwood]
---

ã“ã‚“ã«ã¡ã¯ã€Sunwood-ai-labsã§ã™ðŸ˜Š

## ðŸ”– ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- $title

## ðŸ—‚ï¸ å¤‰æ›´æ¦‚è¦
- ã€Œ$titleã€ã«åŸºã¥ãå¤‰æ›´ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚

## ðŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
- ç¶™ç¶šçš„ã«æ”¹å–„ã‚’é€²ã‚ã¾ã™ã€‚

EOF
done

echo "Generated $(ls "$BLOG_DIR" | wc -l) blog posts in $BLOG_DIR"