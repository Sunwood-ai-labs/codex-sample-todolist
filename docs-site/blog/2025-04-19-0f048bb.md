---
title: "üîÄ Merge: TODO„É™„Çπ„Éà„Ç¢„Éó„É™Ê©üËÉΩËøΩÂä†„Å®Docker ComposeÂØæÂøú"
date: 2025-04-19T15:25:45+09:00
slug: /blog/0f048bb/
authors: [sunwood]
---

~~~diff
diff --git a/.dockerignore b/.dockerignore
new file mode 100644
index 0000000..3949275
--- /dev/null
+++ b/.dockerignore
@@ -0,0 +1,24 @@
+__pycache__/
+*.pyc
+*.pyo
+*.pyd
+.Python
+env/
+venv/
+build/
+develop-eggs/
+dist/
+downloads/
+eggs/
+.eggs/
+lib/
+lib64/
+parts/
+sdist/
+var/
+*.egg-info/
+.installed.cfg
+*.egg
+.git/
+.venv/
+tasks.db
\ No newline at end of file
diff --git a/.gitignore b/.gitignore
index 0a19790..775eb37 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,5 @@
+# Application database
+tasks.db
 # Byte-compiled / optimized / DLL files
 __pycache__/
 *.py[cod]
diff --git a/Dockerfile b/Dockerfile
new file mode 100644
index 0000000..33a184e
--- /dev/null
+++ b/Dockerfile
@@ -0,0 +1,26 @@
+# Use official Python runtime as a parent image
+FROM python:3.9-slim
+
+# Set working directory
+WORKDIR /app
+
+# Install dependencies
+COPY requirements.txt .
+RUN pip install --no-cache-dir -r requirements.txt
+
+# Copy application code
+COPY . .
+# Copy entrypoint script and make executable
+COPY entrypoint.sh /usr/local/bin/entrypoint.sh
+RUN chmod +x /usr/local/bin/entrypoint.sh
+
+# Expose the port Flask will run on
+EXPOSE 5000
+
+# Environment variables
+ENV FLASK_APP=app.py
+ENV FLASK_RUN_HOST=0.0.0.0
+
+# Entrypoint with auto-init and default command
+ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
+CMD ["flask", "run"]
\ No newline at end of file
diff --git a/README.md b/README.md
index 8f0a658..0f69e42 100644
--- a/README.md
+++ b/README.md
@@ -1 +1,48 @@
-# codex-sample-todolist
\ No newline at end of file
+# codex-sample-todolist
+
+A simple Flask-based TODO list application.
+
+## Requirements
+
+- Python 3.7+
+- Flask
+
+## Setup
+
+1. Clone the repository and enter the directory:
+
+   git clone <repo-url>
+   cd codex-sample-todolist
+
+2. (Optional) Create and activate a virtual environment:
+
+   python3 -m venv venv
+   source venv/bin/activate
+
+3. Install dependencies:
+
+   pip install -r requirements.txt
+
+4. Initialize the database:
+
+   flask init-db
+
+5. Run the application:
+
+   flask run
+
+The app will be available at http://127.0.0.1:5000.
+
+## Docker Compose
+
+You can also run the application using Docker Compose:
+
+1. Build and start the service (database will be auto-initialized on first run):
+
+   docker-compose up --build
+
+2. The app will be available at http://localhost:5000.
+
+3. (Optional) To reset the database:
+
+   docker-compose run web flask init-db
diff --git a/app.py b/app.py
new file mode 100644
index 0000000..efd32c4
--- /dev/null
+++ b/app.py
@@ -0,0 +1,127 @@
+#!/usr/bin/env python3
+import sqlite3
+from flask import Flask, render_template, request, redirect, url_for, g, flash
+
+app = Flask(__name__, static_folder='static')
+app.config['DATABASE'] = 'tasks.db'
+app.config['SECRET_KEY'] = 'dev'
+
+def get_db():
+    if 'db' not in g:
+        g.db = sqlite3.connect(
+            app.config['DATABASE'],
+            detect_types=sqlite3.PARSE_DECLTYPES
+        )
+        g.db.row_factory = sqlite3.Row
+    return g.db
+
+@app.teardown_appcontext
+def close_db(exception):
+    db = g.pop('db', None)
+    if db is not None:
+        db.close()
+
+def init_db():
+    db = get_db()
+    with open('schema.sql', 'r') as f:
+        db.executescript(f.read())
+    # Ensure changes are committed
+    db.commit()
+
+@app.cli.command('init-db')
+def init_db_command():
+    """Initialize the database."""
+    init_db()
+    print('Initialized the database.')
+
+@app.before_request
+def ensure_db():
+    """Auto-initialize the database if the task table is missing."""
+    db = get_db()
+    try:
+        db.execute('SELECT 1 FROM task LIMIT 1').fetchone()
+    except sqlite3.OperationalError:
+        init_db()
+    # Lower-level init-db ensures commit, nothing else needed
+
+@app.route('/')
+def index():
+    filter_status = request.args.get('filter', 'all')
+    sort_key = request.args.get('sort', 'due_date')
+    db = get_db()
+    query = 'SELECT * FROM task'
+    conditions = []
+    if filter_status == 'active':
+        conditions.append('complete = 0')
+    elif filter_status == 'completed':
+        conditions.append('complete = 1')
+    if conditions:
+        query += ' WHERE ' + ' AND '.join(conditions)
+    if sort_key in ('due_date', 'created_at', 'priority'):
+        query += f' ORDER BY {sort_key}'
+    tasks = db.execute(query).fetchall()
+    return render_template('index.html', tasks=tasks, filter_status=filter_status, sort_key=sort_key)
+
+@app.route('/add', methods=('POST',))
+def add():
+    title = request.form.get('title', '').strip()
+    due_date = request.form.get('due_date', '')
+    priority = request.form.get('priority', 'Medium')
+    if not title:
+        flash('Title is required.', 'danger')
+    else:
+        db = get_db()
+        db.execute(
+            'INSERT INTO task (title, due_date, priority) VALUES (?, ?, ?)',
+            (title, due_date or None, priority)
+        )
+        db.commit()
+        flash('Task added!', 'success')
+    return redirect(url_for('index'))
+
+@app.route('/<int:task_id>/toggle', methods=('POST',))
+def toggle(task_id):
+    db = get_db()
+    task = db.execute('SELECT complete FROM task WHERE id = ?', (task_id,)).fetchone()
+    if task:
+        new_status = 0 if task['complete'] else 1
+        db.execute('UPDATE task SET complete = ? WHERE id = ?', (new_status, task_id))
+        db.commit()
+        flash('Task status updated.', 'success')
+    else:
+        flash('Task not found.', 'danger')
+    return redirect(url_for('index'))
+
+@app.route('/<int:task_id>/delete', methods=('POST',))
+def delete(task_id):
+    db = get_db()
+    db.execute('DELETE FROM task WHERE id = ?', (task_id,))
+    db.commit()
+    flash('Task deleted.', 'success')
+    return redirect(url_for('index'))
+
+@app.route('/<int:task_id>/edit', methods=('GET', 'POST'))
+def edit(task_id):
+    db = get_db()
+    task = db.execute('SELECT * FROM task WHERE id = ?', (task_id,)).fetchone()
+    if not task:
+        flash('Task not found.', 'danger')
+        return redirect(url_for('index'))
+    if request.method == 'POST':
+        title = request.form.get('title', '').strip()
+        due_date = request.form.get('due_date', '')
+        priority = request.form.get('priority', 'Medium')
+        if not title:
+            flash('Title is required.', 'danger')
+        else:
+            db.execute(
+                'UPDATE task SET title = ?, due_date = ?, priority = ? WHERE id = ?',
+                (title, due_date or None, priority, task_id)
+            )
+            db.commit()
+            flash('Task updated.', 'success')
+        return redirect(url_for('index'))
+    return render_template('edit.html', task=task)
+
+if __name__ == '__main__':
+    app.run(debug=True)
\ No newline at end of file
diff --git a/docker-compose.yml b/docker-compose.yml
new file mode 100644
index 0000000..ab08cfc
--- /dev/null
+++ b/docker-compose.yml
@@ -0,0 +1,11 @@
+services:
+  web:
+    build:
+      context: .
+      dockerfile: Dockerfile
+    ports:
+      - "5000:5000"
+    volumes:
+      - .:/app:delegated
+    environment:
+      - FLASK_ENV=development
\ No newline at end of file
diff --git a/entrypoint.sh b/entrypoint.sh
new file mode 100644
index 0000000..cdc1b73
--- /dev/null
+++ b/entrypoint.sh
@@ -0,0 +1,10 @@
+#!/usr/bin/env sh
+# Auto-initialize the database if not present
+set -e
+# If the database file does not exist in /app, initialize it
+if [ ! -f "/app/tasks.db" ]; then
+  echo "Initializing database..."
+  flask init-db
+fi
+# Execute the provided command (e.g., flask run)
+exec "$@"
\ No newline at end of file
diff --git a/requirements.txt b/requirements.txt
new file mode 100644
index 0000000..297d83e
--- /dev/null
+++ b/requirements.txt
@@ -0,0 +1 @@
+Flask>=2.0
\ No newline at end of file
diff --git a/schema.sql b/schema.sql
new file mode 100644
index 0000000..82ee7ea
--- /dev/null
+++ b/schema.sql
@@ -0,0 +1,9 @@
+DROP TABLE IF EXISTS task;
+CREATE TABLE task (
+    id INTEGER PRIMARY KEY AUTOINCREMENT,
+    title TEXT NOT NULL,
+    due_date DATE,
+    priority TEXT CHECK(priority IN ('Low', 'Medium', 'High')) NOT NULL DEFAULT 'Medium',
+    complete INTEGER NOT NULL DEFAULT 0,
+    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
+);
\ No newline at end of file
diff --git a/static/style.css b/static/style.css
new file mode 100644
index 0000000..bde95cb
--- /dev/null
+++ b/static/style.css
@@ -0,0 +1,8 @@
+body {
+    padding-bottom: 2rem;
+}
+
+table td form button {
+    background: none;
+    border: none;
+}
\ No newline at end of file
diff --git a/templates/base.html b/templates/base.html
new file mode 100644
index 0000000..116ccf9
--- /dev/null
+++ b/templates/base.html
@@ -0,0 +1,31 @@
+<!doctype html>
+<html lang="ja">
+<head>
+    <meta charset="utf-8">
+    <meta name="viewport" content="width=device-width, initial-scale=1">
+    <title>TODO List</title>
+    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
+    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
+</head>
+<body>
+<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
+  <div class="container-fluid">
+    <a class="navbar-brand" href="{{ url_for('index') }}">TODO List</a>
+  </div>
+</nav>
+<div class="container">
+  {% with messages = get_flashed_messages(with_categories=true) %}
+    {% if messages %}
+      {% for category, message in messages %}
+        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
+          {{ message }}
+          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
+        </div>
+      {% endfor %}
+    {% endif %}
+  {% endwith %}
+  {% block content %}{% endblock %}
+</div>
+<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
+</body>
+</html>
\ No newline at end of file
diff --git a/templates/edit.html b/templates/edit.html
new file mode 100644
index 0000000..bbd66a4
--- /dev/null
+++ b/templates/edit.html
@@ -0,0 +1,26 @@
+{% extends 'base.html' %}
+
+{% block content %}
+<h1>Edit Task</h1>
+<form method="post" action="{{ url_for('edit', task_id=task.id) }}" class="row g-3">
+  <div class="col-md-6">
+    <label class="form-label">Title</label>
+    <input type="text" class="form-control" name="title" value="{{ task.title }}" required>
+  </div>
+  <div class="col-auto">
+    <label class="form-label">Due Date</label>
+    <input type="date" class="form-control" name="due_date" value="{{ task.due_date }}">
+  </div>
+  <div class="col-auto">
+    <label class="form-label">Priority</label>
+    <select class="form-select" name="priority">
+      <option value="Low" {% if task.priority=='Low' %}selected{% endif %}>Low</option>
+      <option value="Medium" {% if task.priority=='Medium' %}selected{% endif %}>Medium</option>
+      <option value="High" {% if task.priority=='High' %}selected{% endif %}>High</option>
+    </select>
+  </div>
+  <div class="col-auto align-self-end">
+    <button type="submit" class="btn btn-primary">Save</button>
+  </div>
+</form>
+{% endblock %}
\ No newline at end of file
diff --git a/templates/index.html b/templates/index.html
new file mode 100644
index 0000000..76638af
--- /dev/null
+++ b/templates/index.html
@@ -0,0 +1,80 @@
+{% extends 'base.html' %}
+
+{% block content %}
+<div class="d-flex justify-content-between align-items-center mb-3">
+  <h1>Tasks</h1>
+  <form class="row g-2" method="get" action="{{ url_for('index') }}">
+    <div class="col-auto">
+      <select class="form-select" name="filter" onchange="this.form.submit()">
+        <option value="all" {% if filter_status=='all' %}selected{% endif %}>All</option>
+        <option value="active" {% if filter_status=='active' %}selected{% endif %}>Active</option>
+        <option value="completed" {% if filter_status=='completed' %}selected{% endif %}>Completed</option>
+      </select>
+    </div>
+    <div class="col-auto">
+      <select class="form-select" name="sort" onchange="this.form.submit()">
+        <option value="due_date" {% if sort_key=='due_date' %}selected{% endif %}>Due Date</option>
+        <option value="created_at" {% if sort_key=='created_at' %}selected{% endif %}>Created</option>
+        <option value="priority" {% if sort_key=='priority' %}selected{% endif %}>Priority</option>
+      </select>
+    </div>
+  </form>
+</div>
+<form method="post" action="{{ url_for('add') }}" class="row g-3 mb-4">
+  <div class="col-md-6">
+    <input type="text" class="form-control" name="title" placeholder="New task" required>
+  </div>
+  <div class="col-auto">
+    <input type="date" class="form-control" name="due_date">
+  </div>
+  <div class="col-auto">
+    <select class="form-select" name="priority">
+      <option value="Low">Low</option>
+      <option value="Medium" selected>Medium</option>
+      <option value="High">High</option>
+    </select>
+  </div>
+  <div class="col-auto">
+    <button type="submit" class="btn btn-primary mb-3">Add</button>
+  </div>
+</form>
+<table class="table table-striped">
+  <thead>
+    <tr>
+      <th>Done</th>
+      <th>Title</th>
+      <th>Due Date</th>
+      <th>Priority</th>
+      <th>Created</th>
+      <th>Actions</th>
+    </tr>
+  </thead>
+  <tbody>
+    {% for task in tasks %}
+      <tr class="{% if task.complete %}table-success{% endif %}">
+        <td>
+          <form method="post" action="{{ url_for('toggle', task_id=task.id) }}">
+            <button type="submit" class="btn btn-link p-0">
+              {% if task.complete %}‚úî{% else %}‚úñ{% endif %}
+            </button>
+          </form>
+        </td>
+        <td>{{ task.title }}</td>
+        <td>{{ task.due_date or '-' }}</td>
+        <td>{{ task.priority }}</td>
+        <td>{{ task.created_at }}</td>
+        <td>
+          <a href="{{ url_for('edit', task_id=task.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
+          <form method="post" action="{{ url_for('delete', task_id=task.id) }}" style="display:inline-block" onsubmit="return confirm('Delete this task?');">
+            <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
+          </form>
+        </td>
+      </tr>
+    {% else %}
+      <tr>
+        <td colspan="6" class="text-center">No tasks found.</td>
+      </tr>
+    {% endfor %}
+  </tbody>
+</table>
+{% endblock %}
\ No newline at end of file
~~~
